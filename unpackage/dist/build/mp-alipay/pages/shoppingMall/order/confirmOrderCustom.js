(my["webpackJsonp"]=my["webpackJsonp"]||[]).push([["pages/shoppingMall/order/confirmOrderCustom"],{"32c7":function(e,r,t){"use strict";(function(e){t("d977");a(t("66fd"));var r=a(t("643b"));function a(e){return e&&e.__esModule?e:{default:e}}e(r.default)}).call(this,t("c11b")["createPage"])},5261:function(e,r,t){"use strict";var a={uniNavBar:function(){return t.e("components/uni-nav-bar/uni-nav-bar").then(t.bind(null,"44c0"))},aNodeData:function(){return t.e("components/a-nodeData/a-nodeData").then(t.bind(null,"f6d5"))},uniIcons:function(){return Promise.all([t.e("common/vendor"),t.e("components/uni-icons/uni-icons")]).then(t.bind(null,"6508"))},aGoodLineBox:function(){return Promise.all([t.e("common/vendor"),t.e("components/a-good-lineBox/a-good-lineBox")]).then(t.bind(null,"a0c4"))},aBottomSubmit:function(){return t.e("components/a-bottomSubmit/a-bottomSubmit").then(t.bind(null,"77bb"))},uniPopup:function(){return t.e("components/uni-popup/uni-popup").then(t.bind(null,"a329"))},aReceiveAddress:function(){return Promise.all([t.e("common/vendor"),t.e("components/a-receive-address/a-receive-address")]).then(t.bind(null,"8247"))}},n=function(){var e=this,r=e.$createElement,t=(e._self._c,e.currentDeliveryType.indexOf("2")),a=e.currentDeliveryType.indexOf("3"),n=e.currentDeliveryType.indexOf("2"),i=e.currentDeliveryType.indexOf("1"),o=JSON.stringify(e.currentArea),s=e._f("setSex")(e.currentArea.Sex),u=e.prodList[0].DeliveryType.indexOf("3"),c=e._f("spliceNum")(e.allData.ScoreTotal),d=e._f("spliceNum")(e.totalCurrent),l=e.allData.hasOwnProperty("CardInfo"),f=Number(e.CardInfo.Balance),p=e.__map(e.areaList,(function(r,t){var a=e._f("setSex")(r.Sex);return{$orig:e.__get_orig(r),f3:a}}));e._isMounted||(e.e0=function(r){return e.$refs.showAreaList.close()}),e.$mp.data=Object.assign({},{$root:{g0:t,g1:a,g2:n,g3:i,g4:o,f0:s,g5:u,f1:c,f2:d,g6:l,m0:f,l0:p}})},i=[];t.d(r,"b",(function(){return n})),t.d(r,"c",(function(){return i})),t.d(r,"a",(function(){return a}))},"643b":function(e,r,t){"use strict";t.r(r);var a=t("5261"),n=t("c23d");for(var i in n)"default"!==i&&function(e){t.d(r,e,(function(){return n[e]}))}(i);t("ebca");var o,s=t("f0c5"),u=Object(s["a"])(n["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],o);r["default"]=u.exports},a802:function(e,r,t){},c23d:function(e,r,t){"use strict";t.r(r);var a=t("e9a0"),n=t.n(a);for(var i in a)"default"!==i&&function(e){t.d(r,e,(function(){return a[e]}))}(i);r["default"]=n.a},e9a0:function(e,r,t){"use strict";(function(e){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a=s(t("4795")),n=t("57bb"),i=t("657b"),o=s(t("a055"));function s(e){return e&&e.__esModule?e:{default:e}}function u(e,r,t,a,n,i,o){try{var s=e[i](o),u=s.value}catch(c){return void t(c)}s.done?r(u):Promise.resolve(u).then(a,n)}function c(e){return function(){var r=this,t=arguments;return new Promise((function(a,n){var i=e.apply(r,t);function o(e){u(i,a,n,o,s,"next",e)}function s(e){u(i,a,n,o,s,"throw",e)}o(void 0)}))}}var d=function(){t.e("node-modules/adcell/ADCell").then(function(){return resolve(t("1420"))}.bind(null,t)).catch(t.oe)},l={name:"confirmOrder",mixins:[o.default],components:{adCell:d},data:function(){return{mainStyle:getApp().globalData.mainStyle,mainColor:getApp().globalData.mainColor,loading:!0,currentItem:[],UserRemarks:"",UserTime:"",UserDiscount:"",UserDiscountName:"请选择方案",currentArea:{},radioModes:2,prodList:[],showAreaList:!1,addEditArea:!1,selectTime:!1,discountProgram:!1,resultArea:"",areaList:[],DeliveryAreaList:[],takeOver:[],freight:0,total:0,totalCurrent:0,location:{},activeKey:0,sidebarList:[],rightTimeList:[],radioTime:"",radioPayType:"1",CardInfo:{},phone_user:"",name_user:"",orderId:"",cardSids:[],ProdTotal:0,radioDiscount:"",DiscountList:[],allTimeSlot:[],RecordTime:{},areaInfo:{},currentDeliveryType:"",testData:{},allData:{},totalCurrentScore:0,currentIndex:0}},created:function(){var e=this;return c(a.default.mark((function r(){var t;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.$store.state.currentCard&&0!==e.$store.state.currentCard.length||(e.$Router.back(2),e.$Router.back(100)),r.next=3,e.getWxConfig();case 3:if(t=e.$store.state.currentCard||[],t.forEach((function(r){if(r.SID&&e.cardSids.push(r.SID),r.PartsNo instanceof Array){var t=[],a=JSON.parse(JSON.stringify(r.PartsNo));a.forEach((function(e){t.push(e.ProdNo)})),r.PartsNo=t.join(",")}})),e.currentItem=JSON.stringify(t),e.cardSids=e.cardSids?e.cardSids.join(","):"",!e.$Route.query.isIntegral){r.next=12;break}return r.next=10,e.getInfoIntegral();case 10:r.next=14;break;case 12:return r.next=14,e.getInfo();case 14:case"end":return r.stop()}}),r)})))()},methods:{getInfo:function(){var r=this;return c(a.default.mark((function t(){var o,s;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r.loading=!0,e.showLoading();try{o=JSON.parse(r.currentItem),r.currentDeliveryType=o[0].DeliveryType,s={Action:"SettlePay",ProdList:r.currentItem,DefLongitude:r.location.longitude,DefLatitude:r.location.latitude,DeliveryType:r.currentDeliveryType},o[0].hasOwnProperty("PromotionItemSID")&&(s.PromotionItemSID=o[0].PromotionItemSID),Promise.all([r.saveArea(!0),(0,n.vipCard)(s,"UProdOpera")]).then((function(t){r.areaList=t[0],r.takeOver=t[0];var a=t[1].Data;r.allData=a,r.prodList=a.ProdList,r.currentItem=JSON.parse(JSON.stringify(r.prodList)),r.currentDeliveryType=a.ProdList[0].DeliveryType,r.currentItem.forEach((function(e){"string"!==typeof e.PartsNo&&(e.PartsNo.forEach((function(r,t){e.arr=[],e.arr.push(r.ProdNo)})),e.PartsNo=e.arr?e.arr.join(","):"",delete e.arr),e.PartsList&&(e.PartsList=JSON.stringify(e.PartsList))})),r.currentItem=JSON.stringify(r.currentItem);var n=0;r.prodList.length>0&&r.prodList.forEach((function(e,r){e.DeliveryType&&""!==e.DeliveryType&&(e.DeliveryType=e.DeliveryType.split(",")),e.FinHour>n&&(n=e.FinHour)})),r.freight=a.Freight,r.DiscountList=a.DiscList||[],r.DiscountList.length>0&&(r.radioDiscount=r.DiscountList[0].PrefNo,r.UserDiscount="¥"+(r.DiscountList[0].DiscPrice||0),r.UserDiscountName=r.DiscountList[0].PrefName),r.total=a.SumTotal,r.ProdTotal=a.ProdTotal,r.totalCurrent=parseFloat(Number(a.SumTotal).toFixed(2)),r.CardInfo=a.hasOwnProperty("CardInfo")?a.CardInfo:{},"{}"!==JSON.stringify(r.CardInfo)?Number(a.CardInfo.Balance)<Number(a.SumTotal)&&(r.radioPayType="2"):r.radioPayType="2",r.DeliveryAreaList=a.ShopInfoList;var o=r.areaList.filter((function(e){return"1"===e.Defaults}))[0];r.currentArea=o||{},r.resultArea=o?o.SID:"";var s=Number(a.ShopBase.ScopeDay),u=0,c=0;if(Number(n)/24>=1)u=Number(n)/24,c=0;else{var d=h(a.ShopBase.EndTime),l=h((0,i.getTime)(!1,!1,!0)),m=60*Number(n)*60;(m+l).toFixed(2)>d?(c=Number(n),u+=1):(c=Number(n),u=0)}r.sidebarList=f(s,u);var y=p(a.ShopBase,c,u),v=y.arr,g=y.arrToday;r.allTimeSlot=v,r.todayTimeSlot=g,r.rightTimeList=g,r.radioTime=g[0],r.RecordTime={radioTime:g[0],index:0},r.UserTime=r.sidebarList[r.activeKey]+" "+r.radioTime,r.loading=!1,e.hideLoading()})).catch((function(t){r.loading=!1,e.hideLoading()}))}catch(a){r.loading=!1,e.hideLoading()}case 3:case"end":return t.stop()}}),t)})))()},getInfoIntegral:function(){var r=this;return c(a.default.mark((function t(){var i,o;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.showLoading(),t.next=4,(0,n.vipCard)({Action:"SettlePay",ProdList:r.currentItem},"UIntegralOpera");case 4:i=t.sent,o=i.Data,r.prodList=o.ProdList,r.allData=o,r.CardInfo=o.CardInfo,r.currentItem=JSON.parse(JSON.stringify(r.prodList)),r.totalCurrent=parseFloat(Number(o.SalePriceTotal).toFixed(2)),o.ScoreTotal&&(r.totalCurrentScore=parseFloat(Number(o.ScoreTotal).toFixed(2))||0),r.loading=!1,e.hideLoading(),t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](0),r.loading=!1,e.hideLoading();case 20:case"end":return t.stop()}}),t,null,[[0,16]])})))()},orderArea:function(){},changeMode:function(e){this.radioModes=e,this.areaList=1==e?this.DeliveryAreaList:this.takeOver,this.currentArea={},1===e?this.totalCurrent=this.total-this.freight:(this.totalCurrent=this.total,this.takeOver.filter((function(e){return"1"===e.Defaults})).length>0&&(this.currentArea=this.takeOver.filter((function(e){return"1"===e.Defaults}))[0]),this.resultArea=this.currentArea.SID),this.totalCurrent=parseFloat(Number(this.totalCurrent).toFixed(2))},radioChange:function(){this.showAreaList=!0,this.$refs.showAreaList.open()},radioPayChange:function(e){this.CardInfo&&Number(this.CardInfo.Balance)<this.totalCurrent||(this.radioPayType=e.detail.value)},changeGroup:function(e){this.resultArea=e.detail.value},changeArea:function(r,t){var i=this;return c(a.default.mark((function o(){var s,u,c,d,l;return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i.showAreaList=r.SID,1===i.radioModes?s="IsPickShop":i.currentDeliveryType.indexOf("2")>-1?s="CalcFreight":i.currentDeliveryType.indexOf("3")>-1&&(s="CalcLogistics"),a.prev=2,i.loading=!0,e.showLoading(),u=JSON.parse(i.currentItem),c={Action:s,ProdList:i.currentItem,Latitude:r.Latitude||"",Longitude:r.Longitude||"",Province:r.Province||"",PayType:i.radioPayType,PrefNo:"undefined"===i.radioDiscount?"":i.radioDiscount,ShopSID:r.SID},u[0].hasOwnProperty("PromotionItemSID")&&(c.PromotionItemSID=u[0].PromotionItemSID),a.next=10,(0,n.vipCard)(c,"UProdOpera");case 10:d=a.sent,l=d.Data,i.currentArea=r,i.showAreaList=!1,i.$refs.showAreaList.close(),i.resultArea=r.SID,i.areaList.splice(t,1),i.areaList.unshift(r),i.freight=l.Freight,i.totalCurrent=parseFloat(Number(l.SumTotal).toFixed(2)),i.loading=!1,e.hideLoading(),a.next=28;break;case 24:a.prev=24,a.t0=a["catch"](2),i.loading=!1,e.hideLoading();case 28:case"end":return a.stop()}}),o,null,[[2,24]])})))()},clickEdit:function(e){this.areaInfo=e,this.$refs.addEditArea.open(),this.addEditArea=!0},clickGo:function(){this.$refs.addEditArea.close(),this.addEditArea=!1},clickLeft:function(){this.$Router.push(this.$store.state.historyUrl)},clickDataTime:function(){this.selectTime=!0,this.$refs.selectTime.open()},clickUserDiscount:function(){this.discountProgram=!0,this.$refs.discountProgram.open()},clickTime:function(){},saveAreaSet:function(){var r=this;return c(a.default.mark((function t(){var n;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r.$refs.addEditArea.close(),r.addEditArea=!1,r.loading=!0,e.showLoading(),t.next=6,r.saveArea(!1);case 6:n=t.sent,r.areaList=n,r.takeOver=n,r.loading=!1,e.hideLoading();case 11:case"end":return t.stop()}}),t)})))()},saveArea:function(r){var t=this;return c(a.default.mark((function i(){var o,s,u;return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,t.currentDeliveryType.indexOf("2")>-1?o=1:t.currentDeliveryType.indexOf("3")>-1&&(o=2),a.next=4,(0,n.vipCard)({Action:"GetAddressList",Type:o},"UMemberOpera");case 4:return s=a.sent,u=s.Data,r&&e.showLoading(),a.abrupt("return",u.AddressList);case 10:return a.prev=10,a.t0=a["catch"](0),a.abrupt("return",[]);case 13:case"end":return a.stop()}}),i,null,[[0,10]])})))()},PayTypeClick:function(e){this.CardInfo&&Number(this.CardInfo.Balance)<this.totalCurrent||(this.radioPayType=e)},changeSider:function(e){this.currentIndex=e,this.activeKey=e,this.RecordTime.index===e?this.radioTime=this.RecordTime.radioTime:this.radioTime="",this.rightTimeList=0!==e?this.allTimeSlot:this.todayTimeSlot},rightTimeClick:function(e){this.RecordTime={radioTime:e,index:this.activeKey},this.radioTime=e,this.selectTime=!1,this.$refs.selectTime.close(),this.UserTime=this.sidebarList[this.activeKey]+" "+this.radioTime},radioTimeFun:function(e){this.radioTime=e.detail.value},setDiscountClick:function(e){this.radioDiscount=e.detail.value},DiscountClick:function(r){var t=this;return c(a.default.mark((function i(){var o,s,u,c;return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=r.PrefNo,"undefined"===r&&(o=""),t.discountProgram=!1,t.$refs.discountProgram.close(),a.prev=4,s={Action:"SelectDisc",PrefNo:o,ProdList:t.currentItem,PayType:t.radioPayType,Latitude:t.currentArea.Latitude,Longitude:t.currentArea.Longitude},t.loading=!0,e.showLoading(),a.next=10,(0,n.vipCard)(s,"UProdOpera");case 10:u=a.sent,c=u.Data,t.UserDiscountName="undefined"===r?"优惠券方案":r.PrefName,t.UserDiscount="undefined"===r?"暂不使用":"¥"+r.DiscPrice,t.radioDiscount="undefined"===r?r:r.PrefNo,t.totalCurrent=parseFloat(Number(c.Total?c.Total:c.SumTotal).toFixed(2)),t.loading=!1,e.hideLoading(),a.next=24;break;case 20:a.prev=20,a.t0=a["catch"](4),t.loading=!1,e.hideLoading();case 24:case"end":return a.stop()}}),i,null,[[4,20]])})))()},areaSet:function(){this.areaInfo={},this.addEditArea=!0,this.$refs.addEditArea.open()},submitMoney:function(){var r=this;return c(a.default.mark((function t(){var o,s,u,c,d,l;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("{}"!==JSON.stringify(r.currentArea)||r.$Route.query.isIntegral){t.next=3;break}return r.$toast("请选择地址"),t.abrupt("return");case 3:if(1!==r.radioModes){t.next=15;break}if(r.phone_user&&""!==r.phone_user){t.next=9;break}return r.$toast("请填写手机号码"),t.abrupt("return");case 9:if((0,i.checkMobile)(r.phone_user)){t.next=12;break}return r.$toast("手机号格式错误"),t.abrupt("return");case 12:if(r.name_user&&""!==r.name_user){t.next=15;break}return r.$toast("请填写收件名字"),t.abrupt("return");case 15:if("undefined"===r.radioDiscount&&(r.radioDiscount=""),o=r.radioModes,2===r.radioModes?r.currentDeliveryType.indexOf("2")>-1?o=2:r.currentDeliveryType.indexOf("3")>-1&&(o=3):o=1,"string"!==typeof r.currentItem&&(r.currentItem=JSON.stringify(r.currentItem)),s={Action:"OrderPay",DeliveryType:o,UserName:2===r.radioModes?r.currentArea.Name:r.name_user,Mobile:1===r.radioModes?r.phone_user:r.currentArea.Mobile,Address:2===r.radioModes?r.currentArea.Address+"  "+r.currentArea.House:"",ProdList:r.currentItem,Latitude:r.currentArea.Latitude||"",Longitude:r.currentArea.Longitude||"",Province:r.currentArea.Province||"",AddressSID:2===r.radioModes?r.resultArea.SID:"",ShopSID:1===r.radioModes?r.resultArea:"",UserRemarks:r.UserRemarks,PayType:r.radioPayType,PickDate:r.sidebarList[r.RecordTime.index],PickTime:r.RecordTime.radioTime,CartSID:r.cardSids,PrefNo:r.radioDiscount},JSON.parse(r.currentItem)[0].hasOwnProperty("PromotionItemSID")&&(s.PromotionItemSID=JSON.parse(r.currentItem)[0].PromotionItemSID),!r.$Route.query.isIntegral){t.next=31;break}if(u=JSON.parse(r.currentItem),s=u[0],s.Action="OrderPay",s.PayType=r.radioPayType,s.UserRemarks=r.UserRemarks,s.DeliveryType=1,r.CardInfo){t.next=31;break}return r.$toast.fail("未绑定微卡"),t.abrupt("return");case 31:return c=r.$Route.query.isIntegral?"UIntOrderOpera":"UOrderOpera",r.loading=!0,e.showLoading(),t.prev=34,t.next=37,(0,n.vipCard)(s,c);case 37:if(d=t.sent,l=d.Data,r.loading=!1,e.hideLoading(),r.$store.commit("SET_CURRENT_CARD",[]),e.removeStorageSync("alreadyPaid"),"1"===r.radioPayType)console.log(l,"---"),r.$Router.push({path:"/pages/shoppingMall/order/confirmCard",query:{Balance:r.CardInfo.Balance,Score:r.CardInfo.Score,PayScore:l.hasOwnProperty("PayScore")?l.PayScore:"",total:l.SumTotal,PayNo:l.PayNo,IsPass:l.IsPass,OrderType:l.OrderType}});else{r.testData=l;try{(0,i.weChatPayment)(r,l,!1)}catch(a){that.$toast.fail("微信调起失败"),r.loading=!1,e.hideLoading()}}t.next=50;break;case 46:t.prev=46,t.t0=t["catch"](34),r.loading=!1,e.hideLoading();case 50:case"end":return t.stop()}}),t,null,[[34,46]])})))()}}};function f(e,r){var t=[],a="";e=Number(e);for(var n=0;n<e;n++){var o=864e5,s=r>1?(new Date).getTime()+r*o:(new Date).getTime();a=n*o+s,t.push((0,i.getTime)(a,!0))}return t}function p(e,r,t){var a=3600,n=60*Number(e.IntervalMinute),o=h(e.EndTime),s=Number(h(e.StartTime)),u=[],c=[];while(s<=o)u.push(m(s)),s+=n;return 0==t?u.forEach((function(e){e=h(e),0==t&&e>h((0,i.getTime)(!1,!1,!0))+Number(r)*a&&c.push(m(e))})):c=u,{arr:u,arrToday:c}}function h(e){var r=0,t=e.split(":")[0],a=e.split(":")[1],n=e.split(":")[2];return r=Number(3600*t)+Number(60*a)+Number(n),r}function m(e){var r=parseInt(e),t=0,a=0,n="";return r>60&&(t=parseInt(r/60),r=parseInt(r%60),t>60&&(a=parseInt(t/60),t=parseInt(t%60))),a=a<10?"0"+a:a,t=t<10?"0"+t:t,r=r<10?"0"+r:r,n=a+":"+t+":"+r,n}r.default=l}).call(this,t("c11b")["default"])},ebca:function(e,r,t){"use strict";var a=t("a802"),n=t.n(a);n.a}},[["32c7","common/runtime","common/vendor"]]]);